class h{constructor(){document.querySelector("body")&&console.log("読み込み完了しました")}}class d{header_fix;constructor(e=!1){this.header_fix=e,document.querySelectorAll('a[href^="#"]').forEach(i=>{i.addEventListener("click",a=>{a.preventDefault();const l=i.getAttribute("href");let o;if(l){if(l==="#")o=document.body,s(o);else if(l){if(o=document.getElementById(l.replace("#","")),o&&this.header_fix){const c=document.querySelector("header")?.clientHeight;o.style.scrollMarginBlockStart=String(c)+"px"}s(o)}}})});function s(i){const l=window.matchMedia("(prefers-reduced-motion: reduce)").matches?"instant":"smooth";setTimeout(()=>{i?.focus({preventScroll:!0}),document.activeElement!==i&&(i?.setAttribute("tabindex","-1"),i?.focus({preventScroll:!0})),i?.scrollIntoView({behavior:l,inline:"end"})},0)}const n=location.hash;if(n){const i=document.querySelector(n);if(i){if(this.header_fix){const l=document.querySelector("header")?.clientHeight;i.style.scrollMarginBlockStart=String(l)+"px"}i.scrollIntoView({behavior:"instant",inline:"end"})}}}}class u{nav;btn;wrapper;closeBtn;triggers;openClass;breakpoint;isOpen=!1;focusableElements=[];firstFocusable=null;lastFocusable=null;constructor(e={}){const{navSelector:t=".c_nav",openClass:s="-open",breakpoint:n=768}=e;this.openClass=s,this.breakpoint=n,this.nav=document.querySelector(t),this.nav&&(this.btn=this.nav.querySelector(`${t}_btn`),this.wrapper=this.nav.querySelector(`${t}_wrapper`),this.closeBtn=this.nav.querySelector(`${t}_close`),this.triggers=this.nav.querySelectorAll(`${t}_trigger`),this.init())}init(){this.bindEvents(),this.setupChildMenus(),this.handleResize(),window.addEventListener("resize",()=>this.handleResize())}bindEvents(){this.btn?.addEventListener("click",()=>this.toggle()),this.closeBtn?.addEventListener("click",()=>this.close()),this.wrapper?.addEventListener("click",e=>{e.target===this.wrapper&&this.close()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.isOpen&&(this.close(),this.btn?.focus())}),this.wrapper?.addEventListener("keydown",e=>this.handleFocusTrap(e))}setupChildMenus(){this.triggers.forEach(e=>{const t=e.closest(".c_nav_item"),s=t?.querySelector(".c_nav_child");s&&(e.addEventListener("click",n=>{n.preventDefault(),this.isSP()&&this.toggleChildMenu(e,s)}),t?.addEventListener("mouseenter",()=>{this.isSP()||this.openChildMenu(e,s)}),t?.addEventListener("mouseleave",()=>{this.isSP()||this.closeChildMenu(e,s)}),e.addEventListener("keydown",n=>{!this.isSP()&&(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e.getAttribute("aria-expanded")==="true"?this.closeChildMenu(e,s):this.openChildMenu(e,s))}),t?.addEventListener("focusout",n=>{if(!this.isSP()){const i=n.relatedTarget;t.contains(i)||this.closeChildMenu(e,s)}}))})}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen=!0,this.nav?.classList.add(this.openClass),this.btn?.setAttribute("aria-expanded","true"),this.updateFocusableElements(),setTimeout(()=>{this.firstFocusable?.focus()},100),document.body.style.overflow="hidden"}close(){this.isOpen=!1,this.nav?.classList.remove(this.openClass),this.btn?.setAttribute("aria-expanded","false"),this.triggers.forEach(e=>{const s=e.closest(".c_nav_item")?.querySelector(".c_nav_child");s&&this.closeChildMenu(e,s)}),document.body.style.overflow=""}toggleChildMenu(e,t){e.getAttribute("aria-expanded")==="true"?this.closeChildMenu(e,t):this.openChildMenu(e,t)}openChildMenu(e,t){if(e.setAttribute("aria-expanded","true"),e.closest(".c_nav_item")?.classList.add(this.openClass),this.isSP()){const s=t.scrollHeight;t.style.setProperty("--childHeight",`${s}px`)}t.removeAttribute("hidden")}closeChildMenu(e,t){e.setAttribute("aria-expanded","false"),e.closest(".c_nav_item")?.classList.remove(this.openClass),this.isSP()&&t.style.setProperty("--childHeight","0px"),this.isSP()?setTimeout(()=>{e.getAttribute("aria-expanded")==="false"&&t.setAttribute("hidden","")},300):t.setAttribute("hidden","")}handleFocusTrap(e){e.key!=="Tab"||!this.isSP()||(this.updateFocusableElements(),e.shiftKey?document.activeElement===this.firstFocusable&&(e.preventDefault(),this.lastFocusable?.focus()):document.activeElement===this.lastFocusable&&(e.preventDefault(),this.firstFocusable?.focus()))}updateFocusableElements(){if(!this.wrapper)return;const e=["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(", ");this.focusableElements=Array.from(this.wrapper.querySelectorAll(e)).filter(t=>!t.closest("[hidden]")),this.firstFocusable=this.focusableElements[0]||null,this.lastFocusable=this.focusableElements[this.focusableElements.length-1]||null}handleResize(){!this.isSP()&&this.isOpen&&this.close(),this.isSP()||this.triggers.forEach(e=>{const s=e.closest(".c_nav_item")?.querySelector(".c_nav_child");s&&e.getAttribute("aria-expanded")!=="true"&&s.setAttribute("hidden","")})}isSP(){return window.innerWidth<this.breakpoint}}window.addEventListener("load",()=>{new h,new d,new u});
